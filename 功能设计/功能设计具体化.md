# PKU.MLeague赛事管理系统功能设计具体化

-----

## 一、数据库

### （一）赛程（Game）数据库

1. **比赛编号**（id）：每场比赛具有唯一的编号。
管理员通过“创建比赛”设置，通过“编辑比赛”更改。

2. **队伍座次**：东起（eTeam）、南起（sTeam）、西起（wTeam）、北起（nTeam），分别储存对应的队伍ID。四个座次对应的队伍ID必须互不相同。
管理员通过“创建比赛”设置，通过“编辑比赛”更改。

3. **出战选手**：东起（ePlayer）、南起（sPlayer）、西起（wPlayer）、北起（nPlayer），分别储存对应的出战选手编号。
队长和管理员通过“编辑比赛”设置、更改。

4. **比赛时间**（time）。
管理员可通过“编辑比赛”设置、更改。

5. **比赛状态**（state）：未进行（0）/已进行（1）。
创建比赛时，状态为“未进行”。录入结果后，状态为“已进行”。

6. **终局分数**：东起（eScore）、南起（sScore）、西起（wScore）、北起（nScore），分别储存对应的终局分数。
管理员通过“录入比赛结果”设置、更改（需经过计算）。
根据终局分数可计算得出顺位结果与积分结果。

7. **顺位结果**：东起（ePos）、南起（sPos）、西起（wPos）、北起（nPos），分别储存对应的顺位结果。
管理员通过“录入比赛结果”设置、更改（需经过计算）。

8. **积分结果**：东起（ePt）、南起（sPt）、西起（wPt）、北起（nPt），分别储存对应的积分结果。
管理员通过“录入比赛结果”设置、更改（需经过计算）。

注：**录入比赛结果时录入的终局分数是整数，但经计算转化为积分（Pt）是实数。**

```sql
-- 赛程表
CREATE TABLE IF NOT EXISTS games (
    id          INTEGER PRIMARY KEY,
    eTeam       INTEGER NOT NULL,
    sTeam       INTEGER NOT NULL,
    wTeam       INTEGER NOT NULL,
    nTeam       INTEGER NOT NULL,
    ePlayer     INTEGER,
    sPlayer     INTEGER,
    wPlayer     INTEGER,
    nPlayer     INTEGER,
    time        DATETIME,
    state       INTEGER DEFAULT 0,
    eScore      INTEGER,
    sScore      INTEGER,
    wScore      INTEGER,
    nScore      INTEGER,
    ePos        INTEGER,
    sPos        INTEGER,
    wPos        INTEGER,
    nPos        INTEGER,
    ePt         REAL,
    sPt         REAL,
    wPt         REAL,
    nPt         REAL,
    CHECK (eTeam != sTeam AND eTeam != wTeam AND eTeam != nTeam AND sTeam != wTeam AND sTeam != nTeam AND wTeam != nTeam) -- 座次唯一性约束
    CHECK (eScore + sScore + wScore + nScore  == 1000) --确认最终分数总和为1000
);
```

### （二）队伍（Team）数据库

1. **队伍编号**（id）：每支队伍具有唯一的ID。
预定义，不需修改。

2. **队伍名称**（name）。
预定义，不需修改。

3. **队伍颜色**（color）：队伍的背景色。
预定义，不需修改。

4. **队伍初始积分**（init_pt）：带入本阶段的积分（即“持越”）。
预定义，不需修改。

5. **队伍阶段积分**（stage_pt）：本阶段的积分。
初始为0，每次录入比赛结果后计算并更新。

6. **队伍总积分**（total_pt）：初始积分+阶段积分，是否必要？

7. **队伍比赛数**（count_total）：队伍已进行的比赛场次数。
初始为0，每次录入比赛结果后更新。

8. **队伍顺位计数**：一位（count_1）、二位（count_2）、三位（count_3）、四位（count_4）计数。
初始均为0，每次录入比赛结果后更新。

队伍相关预定义如下：

| 队伍编号 | 队伍名称 | 队伍颜色 | 队伍初始积分 |
| :-: | :-: | :-: | :-: |
| 0 | 格斗 | D00000 | 130.1 |
| 1 | 樱花 | FBD6FB | 87.4 |
| 2 | 凤凰 | EC8600 | 18.8 |
| 3 | 野兽 | 072F79 | 9.2 |

```sql
-- 队伍表
CREATE TABLE IF NOT EXISTS teams (
    id          INTEGER PRIMARY KEY,
    name        TEXT NOT NULL,
    color       TEXT NOT NULL,
    init_pt     REAL NOT NULL,
    stage_pt    REAL DEFAULT 0.0,
    total_pt    REAL NOT NULL, 
    count_total INTEGER DEFAULT 0,
    count_1     INTEGER DEFAULT 0,
    count_2     INTEGER DEFAULT 0,
    count_3     INTEGER DEFAULT 0,
    count_4     INTEGER DEFAULT 0
);
```

### （三）选手（Player）数据库

1. **选手编号**（id）：每个选手具有唯一的ID。
选手ID由“所属队伍ID+队内序号”构造，如樱花的第0位选手ID为“10”。
预定义，不需修改。

2. **选手登录名**（name）。
预定义，不需修改。

3. **选手积分**（pt）：选手在本阶段的积分。
初始为0，每次录入比赛结果后更新。

4. **选手比赛数**（count_total）：选手已进行的比赛计数。
初始为0，每次录入比赛结果后更新。

5. **选手顺位计数**：一位（count_1）、二位（count_2）、三位（count_3）、四位（count_4）计数。
初始均为0，每次录入比赛结果后更新。

6. **最高分**（max_score）：选手终局分数的最高记录。
初始均为0，每次录入比赛结果后更新。

选手相关预定义如下：

| 选手编号 | 选手登录名 |
| :-: | :-: |
| 00 | 前原Nagi |
| 01 | 小鹿 |
| 02 | Rexxx |
| 03 | 忆水 |
| 10 | 炸洋芋 |
| 11 | zombie |
| 12 | Spectator |
| 13 | Xtzzzz |
| 20 | 玖夜 |
| 21 | 树 |
| 22 | 立直里三 |
| 23 | pope |
| 30 | 岸谷 |
| 31 | Yuan |
| 32 | 才彻 |
| 33 | 凛冬 |

```sql
-- 个人表
CREATE TABLE IF NOT EXISTS players (
    id          TEXT PRIMARY KEY,
    name        TEXT NOT NULL,
    pt          REAL DEFAULT 0.0,
    count_total INTEGER DEFAULT 0,
    count_1     INTEGER DEFAULT 0,
    count_2     INTEGER DEFAULT 0,
    count_3     INTEGER DEFAULT 0,
    count_4     INTEGER DEFAULT 0,
    max_score   INTEGER
);
```

### （四）登录模块数据库

分管理员登录与队长登录，储存账号、密码。

-----

## 二、核心功能模块

### （一）队长、管理员登录

使用用户名与密码登录。

### （二）管理赛程（管理员权限）

1. **创建比赛**：设置比赛编号、队伍座次。
如：通过文本编辑框，设置比赛编号为“1”；通过下拉框，设置队伍座次为“东起：0；南起：3；西起：2；北起：1”（实际界面显示队伍名称）。

2. **编辑比赛**：选中比赛，更改比赛编号、队伍座次，设置或更改比赛时间、出战选手。
如：通过文本编辑框（或日期相关方法），设置比赛时间为“2025-05-24 13:30”；通过下拉框，设置出战选手为“东起：03；南起：32；西起：20；北起：12”。

3. **删除比赛**：选中比赛，在数据库中删除对应的比赛。

4. **录入比赛结果**：选中比赛，设置或更改比赛结果。
如：通过文本编辑框，设置比赛结果为“东起：310；南起：260；西起：150；北起：280”。

### （三）编辑出战选手（队长权限）

选中比赛，设置或更改出战选手。
如：通过下拉框，1队队长设置出战选手为“10”。

### （四）显示赛程（访客权限）

1. **简略信息（左栏）**：滚动式，可查看本阶段全部赛程信息。
包括：比赛编号、比赛时间、队伍座次。

2. **详细信息（右栏）**：从左栏选中某场比赛，在右栏中显示详细比赛信息。
包括：比赛编号、比赛时间、队伍座次、出战选手、终局分数、比赛积分。

### （五）显示积分表（访客权限）

参考：/功能设计/赛事介绍/积分表简介.md，生成并显示当前积分表。
注：若查询时直接由数据库生成积分表，则加载速度可能较慢。可考虑每次更新比赛结果后，自动生成最新版本的积分表，查询时以图片形式显示。

-----

（待补充完善）
